---
title: "FPL_Analysis_2223"
author: "Tong Lan"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# **CITS4009 - Project 1**

## Tong LAN (24056082)

## Introduction

The **Premier League** (legal name: **The Football Association Premier League Limited**) represents the highest level of the [English football league system](https://en.wikipedia.org/wiki/English_football_league_system). Twenty clubs compete against each other, with each team playing 38 matches, resulting in a total of 380 matches every season.

(<https://en.wikipedia.org/wiki/Premier_League>)

The dataset used in this project is obtained from [*kaggle.com*](https://www.kaggle.com/), collected by *PAOLO MAZZA*. It contains

Fantasy Premier League(FPL) is the official fantasy football game of English Premier League, played nearly by 8 million managers all across the globe.

The Premier League, also known as the English Premier League or the EPL, is the top level of the English football league system. Contested by 20 clubs, it operates on a system of promotion and relegation with the English Football League. Seasons typically run from August to May with each team playing 38 matches.

<https://www.kaggle.com/datasets/meraxes10/fantasy-premier-league-dataset-2022-2023>

## Goal of the project

This project is for exploring the data of 2011-12 season FPL data, find out the relatinship between players and their overall_points, base on their playing position and their value in the FPL.

## Data loading

### load library

```{r}
library(tidyverse)
library(hrbrthemes)
library(viridis)
```

#### load data.csv

```{r}
path <- "./FPL_Dataset_2022-2023.csv"
fpl_raw_data <- read.csv(path)
```

#### overview the data

```{r}
str(fpl_raw_data)
```

From the structure of the data we can see, there is 713 rows and 19 columns. Next, we use summary() to glimpse the data. We can find out that each row presents a player, so we have 713 players for the 11-12 season, a player get total points from -3 to 244. average is 28, it is a huge range. Then, we can view the default first 6 rows by use head() function, it shows that each row contains many details including how many goals each player scores, assists and so on.

```{r}
summary(fpl_raw_data)
```

```{r}
head(fpl_raw_data)
```

# Initial transform

The next step we try to do is transforming the data, for a easy understanding. For our goal in this project, we should cut the raw data, and remain field of the below list: First_Name, Second_Name, Club, Position, Total_Points. And we can combine the row "First_Name" and row "Second_Name" to a new Row "Name". So, we create a subset named "fpl_data" for further explore. After that, let's take a look at the structure of fpl_data. Transform the data frame into tibble makes it easiler to manipulate.

Rank the players based on their total_point, adding a new column named "Rank" before column "Name".

```{r}
fpl_data <- fpl_raw_data[c(
  "web_name",
  "team",
  "position",
  "total_points",
  "now_cost",
  "minutes",
  "goals_scored",
  "expected_goals",
  "assists",
  "expected_assists",
  "clean_sheets",
  "expected_goals_conceded"
)] %>%
  
  filter(minutes > 1000) %>% 
  
  rename(all_of(
    c(
      player = "web_name",
      club = "team",
      points = "total_points",
      cost = "now_cost",
      goals = "goals_scored",
      xG = "expected_goals",
      xA = "expected_assists",
      cs = "clean_sheets",
      xGc = "expected_goals_conceded"
    )
    
  )) %>%
  mutate(cost = cost / 10)
```

# visualize

## top 50 players

```{r}
fpl_data %>% 
  ggplot(aes(x=points)) +
    geom_density(fill="#69b3a2", color="#e9ecef", alpha=0.8) +
    ggtitle("Points distribution of players(more than 10000 mins)") +
    theme_ipsum()
```

# multiple desity, group by position

```{r}
fpl_data %>% 
  ggplot(aes(x=points, group=position, fill=position)) +
    geom_density(adjust=1.5, alpha=.4) + 
    theme_ipsum() +
    ylab("")
```

# look at the top 50 players

```{r, echo = False}
fpl_data %>% 
  arrange(-points) %>% 
  head(50) %>% 
  ggplot(aes(x = player, y = points)) +
    geom_bar(stat="identity", fill="#69b3a2", alpha=.6, width=0.8) +
    geom_text(aes(label=points), position = position_stack(vjust = 0.9), size = 2) +
    coord_flip() +
    theme(axis.text.y = element_text(size = rel(0.8)))+
    xlab("") +
    theme_bw()
```

# points and positons

```{r}
# create data
doughnut_data <- aggregate(fpl_data$points, by = list(position = fpl_data$position), FUN = sum)

# percentages
doughnut_data$percentage = doughnut_data$x / sum(doughnut_data$x)
doughnut_data$ymax = cumsum(doughnut_data$percentage)
doughnut_data$ymin = c(0, head(doughnut_data$ymax, n=-1))
doughnut_data$labelPosition <- (doughnut_data$ymax + doughnut_data$ymin) / 2
doughnut_data$label <- as.character(round(doughnut_data$percentage, 2) * 100) + '%'

# plot
doughnut_data %>% 
ggplot(aes(ymax = ymax, ymin = ymin, xmax = 4, xmin = 3, fill = position)) +
     geom_rect() +
     coord_polar(theta = "y") + 
#     geom_label(x = 3.5, aes(y = labelPosition, label = label), size = 6) +
     scale_fill_brewer(palette = 2) +
     xlim(c(2, 4)) +
     theme_void()
```




